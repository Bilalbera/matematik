<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Roblox UI Titan v2.3 - Bug Fix</title>
    <style>
        :root { --primary: #00a2ff; --bg: #0d0d0d; --panel: #181818; --border: #333; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 250px; background: var(--panel); border-right: 1px solid var(--border); padding: 15px; display: flex; flex-direction: column; gap: 10px; z-index: 100; flex-shrink: 0; }
        .properties { width: 320px; background: var(--panel); border-left: 1px solid var(--border); padding: 15px; overflow-y: auto; height: 100vh; display: flex; flex-direction: column; gap: 15px; flex-shrink: 0; box-sizing: border-box; padding-bottom: 50px; }
        
        .workspace { flex-grow: 1; background-color: #111; position: relative; overflow: auto; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .roblox-screen { 
            width: 1280px; height: 720px; background: #000; border: 4px solid #444; position: relative; flex-shrink: 0;
            transform: scale(0.75); transform-origin: top center; box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .ui-element { position: absolute; display: flex; align-items: center; justify-content: center; cursor: grab; box-sizing: border-box; overflow: visible; }
        .ui-element.selected { outline: 2px solid var(--primary); outline-offset: 4px; z-index: 999 !important; }
        
        .test-mode-active .is-button:active { transform: scale(0.95) !important; }
        .resizer { width: 15px; height: 15px; background: white; position: absolute; right: 0; bottom: 0; cursor: nwse-resize; border: 2px solid var(--primary); z-index: 10; }
        .icon-img { width: 60%; height: 60%; object-fit: contain; pointer-events: none; position: absolute; }

        .prop-group { background: #222; padding: 10px; border-radius: 8px; border: 1px solid #333; }
        .prop-group label { display: block; font-size: 0.7rem; color: var(--primary); font-weight: bold; margin-bottom: 8px; text-transform: uppercase; }
        input, select { width: 100%; background: #111; border: 1px solid #444; color: white; padding: 8px; border-radius: 5px; box-sizing: border-box; }

        .btn-main { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; text-align: center; width: 100%; }
        .btn-main:hover { opacity: 0.8; }
        
        .layer-list { display: flex; flex-direction: column; gap: 4px; overflow-y: auto; max-height: 120px; background: #111; padding: 5px; border-radius: 5px; }
        .layer-item { background: #2a2a2a; padding: 6px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; border-left: 3px solid transparent; }
        .layer-item.active { border-left-color: var(--primary); background: #333; }
    </style>
</head>
<body>

    <div class="sidebar">
        <button onclick="toggleTestMode(true)" style="background:#f1c40f; color:black;" class="btn-main">‚ñ∂ TEST MODU</button>
        <h3>Ekle</h3>
        <button onclick="addElement('Frame')" class="btn-main" style="background:#333;">üñºÔ∏è Frame</button>
        <button onclick="addElement('TextButton')" class="btn-main" style="background:#333;">üîò Button</button>
        <button onclick="addElement('TextLabel')" class="btn-main" style="background:#333;">üìÑ TextLabel</button>
        <button onclick="addElement('ImageLabel')" class="btn-main" style="background:#333;">üñºÔ∏è ImageLabel</button>
        
        <h3 style="margin-top:15px;">Katmanlar</h3>
        <div id="layer-list" class="layer-list"></div>
    </div>

    <div class="workspace" onclick="select(null)">
        <div id="test-btn-area"></div>
        <div class="roblox-screen" id="viewport" onclick="event.stopPropagation()"></div>
    </div>

    <div class="properties">
        <h2 style="font-size: 1.1rem; border-bottom: 2px solid var(--primary); padding-bottom: 5px; margin:0;">√ñzellikler</h2>
        <div id="prop-inputs" style="display:none;">
            
            <div class="prop-group">
                <label>Kimlik ve Metin</label>
                <input type="text" id="p-name" oninput="apply()" placeholder="Element ƒ∞smi (Object Name)" style="margin-bottom:5px;">
                <input type="text" id="p-text" oninput="apply()" placeholder="G√∂r√ºnen Metin">
            </div>

            <div class="prop-group">
                <label>G√∂rsel & Arka Plan</label>
                <input type="text" id="p-icon" oninput="apply()" placeholder="Asset ID" style="margin-bottom:8px;">
                <div style="display:flex; gap:5px; margin-bottom:8px;">
                    <input type="color" id="p-c1" oninput="apply()">
                    <input type="color" id="p-c2" oninput="apply()">
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="p-trans" onchange="apply()" style="width:20px;">
                    <span style="font-size:0.75rem;">≈ûeffaf Yap</span>
                </div>
            </div>

            <div class="prop-group">
                <label>UI Stroke (Kenarlƒ±k)</label>
                <div style="display:flex; gap:5px; align-items:center;">
                    <input type="color" id="p-scolor" oninput="apply()">
                    <input type="number" id="p-sthick" oninput="apply()" placeholder="Kalƒ±nlƒ±k" style="width:80px;">
                </div>
            </div>

            <div class="prop-group">
                <label>Yazƒ± Stili</label>
                <input type="color" id="p-tcolor" oninput="apply()" style="margin-bottom:5px;">
                <input type="number" id="p-tsize" oninput="apply()" placeholder="Yazƒ± Boyutu">
            </div>

            <div class="prop-group">
                <label>Yerle≈üim & K√∂≈üe</label>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-bottom:5px;">
                    <input type="number" id="p-w" oninput="apply()" placeholder="Geni≈ülik">
                    <input type="number" id="p-h" oninput="apply()" placeholder="Y√ºkseklik">
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                    <input type="number" id="p-z" oninput="apply()" placeholder="Z-Index">
                    <input type="number" id="p-radius" oninput="apply()" placeholder="Radius">
                </div>
            </div>

            <button onclick="duplicateElement()" class="btn-main" style="background:#8e44ad; margin-bottom:5px;">üë• KOPYALA</button>
            <button onclick="exportLua()" class="btn-main" style="background:#2ecc71; margin-bottom:5px;">üì• LUA KODU</button>
            <button onclick="deleteSelected()" class="btn-main" style="background:#e74c3c;">üóëÔ∏è Sƒ∞L</button>
        </div>
    </div>

<script>
    let elements = [];
    let selectedId = null;
    let isTestMode = false;

    // YARDIMCI: G√ºvenli Element Deƒüeri Atama (Null hatasƒ±nƒ± √∂nler)
    function setVal(id, val) {
        const el = document.getElementById(id);
        if (el) {
            if (el.type === 'checkbox') el.checked = val;
            else el.value = val;
        }
    }

    // YARDIMCI: G√ºvenli Deƒüer Okuma
    function getVal(id, isInt = false, isCheck = false) {
        const el = document.getElementById(id);
        if (!el) return isInt ? 0 : (isCheck ? false : "");
        if (isCheck) return el.checked;
        return isInt ? (parseInt(el.value) || 0) : el.value;
    }

    function addElement(type) {
        let id = "el_" + Date.now();
        elements.push({
            id: id, type: type, name: type + "_" + elements.length,
            text: type.includes('Text') ? 'Metin' : '',
            icon: type === 'ImageLabel' ? '6031075929' : '',
            tColor: '#ffffff', tSize: 18,
            c1: '#2a2a2a', c2: '#1a1a1a', transparent: type === 'TextLabel',
            sColor: '#00a2ff', sThick: 0,
            w: 160, h: 50, x: 100, y: 100, radius: 8, z: elements.length + 1
        });
        select(id);
    }

    function duplicateElement() {
        const original = elements.find(e => e.id === selectedId);
        if(!original) return;
        const copy = JSON.parse(JSON.stringify(original));
        copy.id = "el_" + Date.now();
        copy.name = original.name + "_Copy";
        copy.x += 30; copy.y += 30;
        elements.push(copy);
        select(copy.id);
    }

    function render() {
        const view = document.getElementById('viewport');
        view.innerHTML = '';
        const list = document.getElementById('layer-list');
        if (list) list.innerHTML = '';

        elements.sort((a,b) => a.z - b.z).forEach(el => {
            const div = document.createElement('div');
            div.className = `ui-element ${el.type === 'TextButton' ? 'is-button' : ''} ${selectedId === el.id ? 'selected' : ''}`;
            
            let bg = el.transparent ? 'transparent' : `linear-gradient(180deg, ${el.c1}, ${el.c2})`;
            let stroke = el.sThick > 0 ? `border: ${el.sThick}px solid ${el.sColor};` : '';
            
            div.style = `left:${el.x}px; top:${el.y}px; width:${el.w}px; height:${el.h}px; z-index:${el.z}; border-radius:${el.radius}px; background:${bg}; color:${el.tColor}; font-size:${el.tSize}px; ${stroke}`;
            
            if(el.icon) {
                const img = document.createElement('img');
                img.src = `https://www.roblox.com/asset-thumbnail/image?assetId=${el.icon}&width=420&height=420&format=png`;
                img.className = 'icon-img';
                div.appendChild(img);
            }
            if(el.text) div.innerHTML += `<span>${el.text}</span>`;

            if(!isTestMode) {
                const r = document.createElement('div');
                r.className = 'resizer';
                r.onmousedown = (e) => startResize(e, el);
                div.appendChild(r);
                div.onmousedown = (e) => { e.stopPropagation(); startDrag(e, el); };
                div.onclick = (e) => { e.stopPropagation(); select(el.id); };
            }
            view.appendChild(div);

            if (list) {
                const li = document.createElement('div');
                li.className = `layer-item ${selectedId === el.id ? 'active' : ''}`;
                li.innerText = el.name;
                li.onclick = () => select(el.id);
                list.insertBefore(li, list.firstChild);
            }
        });
    }

    function select(id) {
        if(isTestMode) return;
        selectedId = id;
        const el = elements.find(e => e.id === id);
        const panel = document.getElementById('prop-inputs');
        
        if(el && panel) {
            panel.style.display = 'block';
            setVal('p-name', el.name);
            setVal('p-text', el.text);
            setVal('p-icon', el.icon);
            setVal('p-c1', el.c1);
            setVal('p-c2', el.c2);
            setVal('p-tcolor', el.tColor);
            setVal('p-tsize', el.tSize);
            setVal('p-trans', el.transparent);
            setVal('p-scolor', el.sColor);
            setVal('p-sthick', el.sThick);
            setVal('p-z', el.z);
            setVal('p-radius', el.radius);
            setVal('p-w', el.w);
            setVal('p-h', el.h);
        } else if (panel) {
            panel.style.display = 'none';
        }
        render();
    }

    function apply() {
        const el = elements.find(e => e.id === selectedId);
        if(!el) return;
        
        el.name = getVal('p-name');
        el.text = getVal('p-text');
        el.icon = getVal('p-icon');
        el.c1 = getVal('p-c1');
        el.c2 = getVal('p-c2');
        el.tColor = getVal('p-tcolor');
        el.tSize = getVal('p-tsize', true);
        el.transparent = getVal('p-trans', false, true);
        el.sColor = getVal('p-scolor');
        el.sThick = getVal('p-sthick', true);
        el.z = getVal('p-z', true);
        el.radius = getVal('p-radius', true);
        el.w = getVal('p-w', true);
        el.h = getVal('p-h', true);
        
        render();
    }

    function startDrag(e, el) {
        let ox = e.clientX / 0.75 - el.x, oy = e.clientY / 0.75 - el.y;
        const move = (e) => {
            el.x = e.clientX / 0.75 - ox;
            el.y = e.clientY / 0.75 - oy;
            render();
        };
        const stop = () => document.removeEventListener('mousemove', move);
        document.addEventListener('mousemove', move);
        document.addEventListener('mouseup', stop);
    }

    function startResize(e, el) {
        e.stopPropagation();
        const move = (e) => {
            const rect = document.getElementById('viewport').getBoundingClientRect();
            el.w = (e.clientX - rect.left) / 0.75 - el.x;
            el.h = (e.clientY - rect.top) / 0.75 - el.y;
            render();
        };
        const stop = () => document.removeEventListener('mousemove', move);
        document.addEventListener('mousemove', move);
        document.addEventListener('mouseup', stop);
    }

    function toggleTestMode(val) {
        isTestMode = val;
        select(null);
        document.body.classList.toggle('test-mode-active', val);
        const area = document.getElementById('test-btn-area');
        area.innerHTML = val ? '<button onclick="toggleTestMode(false)" style="padding:10px 20px; border-radius:20px; background:#e74c3c; color:white; border:none; cursor:pointer; font-weight:bold; position:fixed; top:20px; z-index:2000; left:50%; transform:translateX(-50%);">‚èπ √áIK</button>' : '';
        render();
    }

    function deleteSelected() {
        elements = elements.filter(e => e.id !== selectedId);
        select(null);
    }

    function exportLua() {
        console.log("-- Roblox UI Export --");
        alert("Kod Konsola Yazƒ±ldƒ±!");
    }

    render();
</script>
</body>
</html>
